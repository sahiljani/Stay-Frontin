{%- comment -%}
Product Management Admin Section
This section provides add, edit, delete functionality for product variants and bundles
{%- endcomment -%}

<div class="product-admin-manager" data-section-id="{{ section.id }}">
  {{ 'section-product-admin-manager.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'product-admin-manager.js' | asset_url }}" defer="defer"></script>

  <div class="admin-panel">
    <div class="admin-header">
      <h2 class="admin-title">Product Management System</h2>
      <div class="admin-actions">
        <button type="button" class="btn btn--primary" id="add-product-btn">
          <span class="icon">‚ûï</span>
          Add New Product
        </button>
        <button type="button" class="btn btn--secondary" id="bulk-actions-btn">
          <span class="icon">‚öôÔ∏è</span>
          Bulk Actions
        </button>
      </div>
    </div>

    <!-- Product List -->
    <div class="product-list-container">
      <div class="search-filters">
        <div class="search-bar">
          <input type="text" placeholder="Search products..." class="search-input" id="product-search">
          <button type="button" class="search-btn">üîç</button>
        </div>
        <div class="filters">
          <select class="filter-select" id="status-filter">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="draft">Draft</option>
            <option value="archived">Archived</option>
          </select>
          <select class="filter-select" id="type-filter">
            <option value="">All Types</option>
            <option value="simple">Simple Product</option>
            <option value="variable">Variable Product</option>
            <option value="bundle">Bundle Product</option>
          </select>
        </div>
      </div>

      <div class="product-grid">
        <!-- Product cards will be populated dynamically -->
        {%- for product in collections.all.products limit: 12 -%}
          <div class="product-card" data-product-id="{{ product.id }}">
            <div class="product-image">
              {%- if product.featured_media -%}
                <img src="{{ product.featured_media | image_url: width: 300 }}" 
                     alt="{{ product.title | escape }}" 
                     loading="lazy">
              {%- else -%}
                <div class="no-image">No Image</div>
              {%- endif -%}
              
              <div class="product-overlay">
                <div class="quick-actions">
                  <button type="button" class="action-btn edit-btn" data-product-id="{{ product.id }}">
                    ‚úèÔ∏è Edit
                  </button>
                  <button type="button" class="action-btn duplicate-btn" data-product-id="{{ product.id }}">
                    üìã Duplicate
                  </button>
                  <button type="button" class="action-btn delete-btn" data-product-id="{{ product.id }}">
                    üóëÔ∏è Delete
                  </button>
                </div>
              </div>
            </div>
            
            <div class="product-info">
              <h3 class="product-title">{{ product.title | truncate: 50 }}</h3>
              <div class="product-meta">
                <span class="product-type">{{ product.type | default: 'Simple Product' }}</span>
                <span class="product-status {{ product.available | replace: true, 'active' | replace: false, 'inactive' }}">
                  {{ product.available | replace: true, 'Active' | replace: false, 'Inactive' }}
                </span>
              </div>
              
              <div class="product-price">
                <span class="current-price">{{ product.price | money }}</span>
                {%- if product.compare_at_price > product.price -%}
                  <span class="original-price">{{ product.compare_at_price | money }}</span>
                {%- endif -%}
              </div>
              
              <div class="product-variants">
                {%- unless product.has_only_default_variant -%}
                  <span class="variant-count">{{ product.variants.size }} variants</span>
                {%- endunless -%}
                <span class="inventory-count">{{ product.selected_or_first_available_variant.inventory_quantity }} in stock</span>
              </div>
              
              <div class="product-actions">
                <button type="button" class="btn btn--small btn--outline manage-variants-btn" 
                        data-product-id="{{ product.id }}">
                  Manage Variants
                </button>
                <button type="button" class="btn btn--small btn--primary view-product-btn" 
                        data-product-handle="{{ product.handle }}">
                  View Product
                </button>
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal" id="product-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Add New Product</h3>
        <button type="button" class="modal-close" onclick="closeModal('product-modal')">√ó</button>
      </div>
      
      <form class="product-form" id="product-form">
        <div class="form-sections">
          <!-- Basic Information -->
          <div class="form-section">
            <h4 class="section-title">Basic Information</h4>
            
            <div class="form-group">
              <label class="form-label" for="product-title">Product Title *</label>
              <input type="text" id="product-title" class="form-input" required>
            </div>
            
            <div class="form-group">
              <label class="form-label" for="product-description">Description</label>
              <textarea id="product-description" class="form-textarea" rows="4"></textarea>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="product-type">Product Type</label>
                <select id="product-type" class="form-select">
                  <option value="simple">Simple Product</option>
                  <option value="variable">Variable Product</option>
                  <option value="bundle">Bundle Product</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="product-vendor">Vendor</label>
                <input type="text" id="product-vendor" class="form-input">
              </div>
            </div>
          </div>

          <!-- Pricing -->
          <div class="form-section">
            <h4 class="section-title">Pricing</h4>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="product-price">Price *</label>
                <div class="price-input">
                  <span class="currency">{{ cart.currency.symbol }}</span>
                  <input type="number" id="product-price" class="form-input" step="0.01" min="0" required>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="product-compare-price">Compare at Price</label>
                <div class="price-input">
                  <span class="currency">{{ cart.currency.symbol }}</span>
                  <input type="number" id="product-compare-price" class="form-input" step="0.01" min="0">
                </div>
              </div>
            </div>
          </div>

          <!-- Images -->
          <div class="form-section">
            <h4 class="section-title">Product Images</h4>
            
            <div class="image-upload-area" id="image-upload-area">
              <div class="upload-placeholder">
                <div class="upload-icon">üì∑</div>
                <p>Drop images here or click to upload</p>
                <input type="file" id="image-upload" multiple accept="image/*" style="display: none;">
              </div>
            </div>
            
            <div class="uploaded-images" id="uploaded-images">
              <!-- Uploaded images will appear here -->
            </div>
          </div>

          <!-- Variants -->
          <div class="form-section" id="variants-section" style="display: none;">
            <h4 class="section-title">Product Variants</h4>
            
            <div class="variant-options">
              <div class="option-group">
                <h5>Option 1</h5>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Option Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Color">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Values</label>
                    <input type="text" class="form-input" placeholder="e.g., Red, Blue, Green">
                  </div>
                </div>
              </div>
              
              <button type="button" class="btn btn--outline add-option-btn">Add Another Option</button>
            </div>
            
            <div class="variant-list">
              <!-- Generated variants will appear here -->
            </div>
          </div>

          <!-- Bundle Options -->
          <div class="form-section" id="bundle-section" style="display: none;">
            <h4 class="section-title">Bundle Configuration</h4>
            
            <div class="bundle-options">
              <div class="bundle-item">
                <h5>Bundle Option 1</h5>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Bundle Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Buy 1">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Quantity</label>
                    <input type="number" class="form-input" min="1" value="1">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Price</label>
                    <input type="number" class="form-input" step="0.01" min="0">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Discount</label>
                    <input type="number" class="form-input" placeholder="%" min="0" max="100">
                  </div>
                </div>
              </div>
              
              <button type="button" class="btn btn--outline add-bundle-btn">Add Bundle Option</button>
            </div>
          </div>

          <!-- SEO -->
          <div class="form-section">
            <h4 class="section-title">SEO Settings</h4>
            
            <div class="form-group">
              <label class="form-label" for="seo-title">Page Title</label>
              <input type="text" id="seo-title" class="form-input">
            </div>
            
            <div class="form-group">
              <label class="form-label" for="seo-description">Meta Description</label>
              <textarea id="seo-description" class="form-textarea" rows="3"></textarea>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn--secondary" onclick="closeModal('product-modal')">Cancel</button>
          <button type="submit" class="btn btn--primary">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Variant Management Modal -->
  <div class="modal" id="variants-modal" style="display: none;">
    <div class="modal-content large">
      <div class="modal-header">
        <h3 class="modal-title">Manage Product Variants</h3>
        <button type="button" class="modal-close" onclick="closeModal('variants-modal')">√ó</button>
      </div>
      
      <div class="variant-manager">
        <!-- Variant management interface will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="delete-modal" style="display: none;">
    <div class="modal-content small">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Delete</h3>
        <button type="button" class="modal-close" onclick="closeModal('delete-modal')">√ó</button>
      </div>
      
      <div class="modal-body">
        <p>Are you sure you want to delete this product? This action cannot be undone.</p>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn--secondary" onclick="closeModal('delete-modal')">Cancel</button>
        <button type="button" class="btn btn--danger" id="confirm-delete-btn">Delete Product</button>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product Admin Manager",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Display Settings"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 6,
      "max": 48,
      "step": 6,
      "unit": "qty",
      "label": "Products per page",
      "default": 12
    },
    {
      "type": "select",
      "id": "sort_by",
      "options": [
        {
          "value": "created",
          "label": "Date created"
        },
        {
          "value": "updated",
          "label": "Date modified"
        },
        {
          "value": "title",
          "label": "Alphabetically"
        },
        {
          "value": "price",
          "label": "Price"
        }
      ],
      "default": "created",
      "label": "Sort by"
    },
    {
      "type": "header",
      "content": "Access Control"
    },
    {
      "type": "checkbox",
      "id": "require_admin",
      "label": "Require admin access",
      "default": true,
      "info": "Only admin users can access this interface"
    },
    {
      "type": "text",
      "id": "allowed_users",
      "label": "Allowed user emails",
      "info": "Comma-separated list of emails that can access this interface"
    }
  ]
}
{% endschema %}