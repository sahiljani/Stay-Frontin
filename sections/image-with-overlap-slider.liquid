{% comment %}
  Section: Image + Overlap Product Slider
  - Left image: 40% width
  - Right slider panel: 60% width with configurable negative overlap
{% endcomment %}

{%- liquid
  assign overlap = section.settings.overlap | default: 5
  assign max_items = section.settings.max_items | default: 8
  assign panel_bg = section.settings.panel_bg | default: '#ffffff'
  assign page_bg  = section.settings.page_bg  | default: '#f7f5f3'
  assign radius   = section.settings.radius | default: 18
-%}

<style>
  #shopify-section-{{ section.id }} .ios-wrap{
    --gap: clamp(16px, 2vw, 28px);
    --overlap: {{ overlap }}%;
    --radius: {{ radius }}px;
    --panel-bg: {{ panel_bg }};
    --page-bg: {{ page_bg }};
    background: var(--page-bg);
    padding: clamp(24px, 3vw, 48px);
  }
  #shopify-section-{{ section.id }} .ios-grid{
    display:grid;
    grid-template-columns: 2fr 3fr; /* 40% / 60% */
    gap: var(--gap);
    align-items: stretch;
    position: relative;
  }
  @media (max-width: 990px){
    #shopify-section-{{ section.id }} .ios-grid{
      grid-template-columns: 1fr;
    }
  }

  /* Left image */
  #shopify-section-{{ section.id }} .ios-image{
    position: relative;
    border-radius: var(--radius);
    overflow: hidden;
    height: min(70vh, 560px);
  }
  #shopify-section-{{ section.id }} .ios-image img{
    width:100%; height:100%; object-fit:cover; display:block;
  }

  /* Slider panel */
  #shopify-section-{{ section.id }} .ios-panel{
    position: relative;
    background: var(--panel-bg);
    border-radius: var(--radius);
    padding: clamp(16px, 2vw, 28px);
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    z-index: 2;
  }

  /* Overlap (desktop only) */
  @media (min-width: 991px){
    #shopify-section-{{ section.id }} .ios-panel{
      margin-left: calc(-1 * var(--overlap));
    }
  }

  /* Header row */
  #shopify-section-{{ section.id }} .ios-head{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    margin-bottom: clamp(10px, 1.5vw, 18px);
  }
  #shopify-section-{{ section.id }} .ios-title{
    margin:0; font-size: clamp(22px, 3vw, 34px); line-height:1.2;
  }
  #shopify-section-{{ section.id }} .ios-nav{
    display:flex; gap:8px;
  }
  #shopify-section-{{ section.id }} .ios-btn{
    width:38px; height:38px; border-radius:999px; border:1px solid rgba(0,0,0,.12);
    display:grid; place-items:center; background:#fff; cursor:pointer;
  }

  /* Products scroller */
  #shopify-section-{{ section.id }} .ios-track{
    display:flex; gap: clamp(12px, 1.6vw, 18px);
    overflow:auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 6px;
  }
  #shopify-section-{{ section.id }} .ios-card{
    flex: 0 0 min(240px, 42vw);
    background:#fff; border:1px solid rgba(0,0,0,.06);
    border-radius: 14px; scroll-snap-align:start; overflow:hidden;
  }
  #shopify-section-{{ section.id }} .ios-card .media{
    width:100%; aspect-ratio: 1/1; background:#f4f4f4;
    display:block; object-fit:contain;
  }
  #shopify-section-{{ section.id }} .ios-card .body{
    padding: 12px 14px 16px;
  }
  #shopify-section-{{ section.id }} .ios-card .vendor{
    font-size:12px; letter-spacing:.06em; color:#999; text-transform:uppercase;
  }
  #shopify-section-{{ section.id }} .ios-card .title{
    font-size:14px; line-height:1.35; margin:.25rem 0 .4rem 0; color:#111;
  }
  #shopify-section-{{ section.id }} .ios-price{
    display:flex; gap:8px; align-items:baseline; font-weight:700;
  }
  #shopify-section-{{ section.id }} .ios-price s{ color:#888; font-weight:400; }

  /* Hide scrollbar (nice but optional) */
  #shopify-section-{{ section.id }} .ios-track::-webkit-scrollbar{ height:8px; }
  #shopify-section-{{ section.id }} .ios-track::-webkit-scrollbar-thumb{ background:rgba(0,0,0,.15); border-radius:8px; }
</style>

<section class="ios-wrap">
  <div class="ios-grid">
    <!-- Left image (40%) -->
    <div class="ios-image">
      {%- if section.settings.left_image != blank -%}
        {% assign widths = '750|1100|1500|1900' | split: '|' %}
        <img
          srcset="{% for w in widths %}{{ section.settings.left_image | image_url: width: w | escape }} {{ w }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
          sizes="(min-width: 991px) 40vw, 100vw"
          src="{{ section.settings.left_image | image_url: width: 1500 }}"
          alt="{{ section.settings.left_image.alt | escape }}"
          width="{{ section.settings.left_image.width }}"
          height="{{ section.settings.left_image.height }}"
          loading="lazy">
      {%- else -%}
        {{ 'image' | placeholder_svg_tag }}
      {%- endif -%}
    </div>

    <!-- Right panel + product slider (60% + overlap) -->
    <div class="ios-panel">
      <div class="ios-head">
        <h2 class="ios-title">{{ section.settings.heading }}</h2>
        <div class="ios-nav" aria-hidden="true">
          <button class="ios-btn" data-dir="-1" aria-label="Previous">‹</button>
          <button class="ios-btn" data-dir="1" aria-label="Next">›</button>
        </div>
      </div>

      <div class="ios-track" id="track-{{ section.id }}">
        {%- assign coll = section.settings.collection -%}
        {%- if coll and coll.products_count > 0 -%}
        {%- for product in coll.products limit: max_items -%}
            <a class="ios-card" href="{{ product.url }}">
            {% if product.featured_media %}
                {{ product.featured_media | image_url: width: 640 | image_tag: class: 'media', loading: 'lazy', alt: product.title }}
            {% else %}
                <div class="media"></div>
            {% endif %}
            <div class="body">
                <div class="vendor">{{ product.vendor }}</div>
                <div class="title">{{ product.title }}</div>
                <div class="ios-price">
                <span>{{ product.price | money }}</span>
                {%- if product.compare_at_price_max > product.price -%}
                    <s>{{ product.compare_at_price_max | money }}</s>
                {%- endif -%}
                </div>
            </div>
            </a>
        {%- endfor -%}   

        {%- else -%}
          {%- for i in (1..6) -%}
            <div class="ios-card">
              <div class="media"></div>
              <div class="body">
                <div class="vendor">Brand</div>
                <div class="title">Product title</div>
                <div class="ios-price"><span>$24.00</span></div>
              </div>
            </div>
          {%- endfor -%}
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

<script>
  (function(){
    const track = document.getElementById('track-{{ section.id }}');
    if(!track) return;
    const btns = track.closest('.ios-panel').querySelectorAll('[data-dir]');
    btns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const dir = parseInt(btn.dataset.dir,10) || 1;
        const card = track.querySelector('.ios-card');
        const step = card ? card.getBoundingClientRect().width + parseFloat(getComputedStyle(track).columnGap||18) : 260;
        track.scrollBy({left: dir*step, behavior:'smooth'});
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Image + Overlap slider",
  "tag": "section",
  "class": "section image-overlap-slider",
  "settings": [
    { "type": "image_picker", "id": "left_image", "label": "Left image" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "NEW SKIN & HAIR CARE PRODUCTS" },
    { "type": "collection", "id": "collection", "label": "Product collection" },
    { "type": "range", "id": "max_items", "label": "Max products", "min": 4, "max": 20, "step": 1, "default": 8 },
    { "type": "range", "id": "overlap", "label": "Overlap onto image (%)", "min": 0, "max": 12, "step": 1, "default": 5 },
    { "type": "range", "id": "radius", "label": "Corner radius (px)", "min": 0, "max": 28, "step": 1, "default": 18 },
    { "type": "color", "id": "panel_bg", "label": "Panel background", "default": "#ffffff" },
    { "type": "color", "id": "page_bg", "label": "Section background", "default": "#f6f2ef" }
  ],
  "presets": [
    { "name": "Image + Overlap slider" }
  ]
}
{% endschema %}
