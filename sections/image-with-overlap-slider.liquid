{% comment %}
Image left (40%) + Product carousel right (60%)
Always fixed 40/60 split. Right side shows 3 products at a time.
{% endcomment %}

{%- assign coll = section.settings.collection -%}
{%- assign max_items = section.settings.max_items | default: 6 -%}

<style>
  #shopify-section-{{ section.id }} .split-wrap {
    display: grid;
    grid-template-columns: 40% 60%;
    align-items: stretch;
    gap: 0;
  }
  @media (max-width: 990px) {
    #shopify-section-{{ section.id }} .split-wrap {
      grid-template-columns: 1fr;
    }
  }

  /* Left image */
  #shopify-section-{{ section.id }} .split-image {
    position: relative;
    overflow: hidden;
  }
  #shopify-section-{{ section.id }} .split-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Right carousel */
  #shopify-section-{{ section.id }} .split-carousel {
    position: relative;
    background: #fff;
    padding: 2rem 1rem;
  }
  #shopify-section-{{ section.id }} .carousel-track {
    display: flex;
    transition: transform 0.4s ease;
  }
  #shopify-section-{{ section.id }} .carousel-card {
    flex: 0 0 calc(100% / 3); /* exactly 3 cards visible */
    box-sizing: border-box;
    padding: 0 0.5rem;
  }
  #shopify-section-{{ section.id }} .carousel-card-inner {
    border: 1px solid #eee;
    border-radius: 10px;
    overflow: hidden;
    background: #fff;
    text-align: center;
  }
  #shopify-section-{{ section.id }} .carousel-card img {
    width: 100%;
    aspect-ratio: 1/1;
    object-fit: contain;
    background: #f8f8f8;
  }
  #shopify-section-{{ section.id }} .carousel-card .body {
    padding: 0.75rem;
  }
  #shopify-section-{{ section.id }} .carousel-card .title {
    font-size: 14px;
    margin: 0.5rem 0;
    min-height: 2.6em;
  }
  #shopify-section-{{ section.id }} .carousel-card .price {
    font-weight: 700;
  }

  /* Nav buttons */
  #shopify-section-{{ section.id }} .carousel-nav {
    position: absolute;
    top: 50%;
    right: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    transform: translateY(-50%);
  }
  #shopify-section-{{ section.id }} .carousel-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid #ddd;
    background: #fff;
    display: grid;
    place-items: center;
    cursor: pointer;
  }
</style>

<div class="split-wrap">
  <!-- Left image -->
  <div class="split-image">
    {%- if section.settings.left_image != blank -%}
      <img
        src="{{ section.settings.left_image | image_url: width: 1200 }}"
        alt="{{ section.settings.left_image.alt | escape }}"
        loading="lazy">
    {%- else -%}
      {{ 'image' | placeholder_svg_tag }}
    {%- endif -%}
  </div>

  <!-- Right product carousel -->
  <div class="split-carousel">
    <h2>{{ section.settings.heading }}</h2>
    <div class="carousel-window">
      <div class="carousel-track" id="track-{{ section.id }}">
        {%- if coll and coll.products_count > 0 -%}
          {%- for product in coll.products limit: max_items -%}
            <div class="carousel-card">
              <div class="carousel-card-inner">
                {% if product.featured_media %}
                  {{ product.featured_media | image_url: width: 500 | image_tag: loading: 'lazy', alt: product.title }}
                {% else %}
                  <div style="background:#eee;aspect-ratio:1/1;"></div>
                {% endif %}
                <div class="body">
                  <div class="title">{{ product.title }}</div>
                  <div class="price">{{ product.price | money }}</div>
                </div>
              </div>
            </div>
          {%- endfor -%}
        {%- else -%}
          {%- for i in (1..6) -%}
            <div class="carousel-card">
              <div class="carousel-card-inner">
                <div style="background:#eee;aspect-ratio:1/1;"></div>
                <div class="body">
                  <div class="title">Product title</div>
                  <div class="price">$24.00</div>
                </div>
              </div>
            </div>
          {%- endfor -%}
        {%- endif -%}
      </div>
    </div>
    <div class="carousel-nav">
      <button class="carousel-btn" data-dir="-1">‹</button>
      <button class="carousel-btn" data-dir="1">›</button>
    </div>
  </div>
</div>

<script>
  (function(){
    const track = document.getElementById('track-{{ section.id }}');
    if(!track) return;
    const btns = track.closest('.split-carousel').querySelectorAll('[data-dir]');
    let index = 0;
    const cards = track.querySelectorAll('.carousel-card');
    const visible = 3;

    function update(){
      const step = 100/visible;
      track.style.transform = `translateX(${-index*step}%)`;
    }

    btns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const dir = parseInt(btn.dataset.dir,10);
        index = Math.max(0, Math.min(cards.length-visible, index+dir));
        update();
      });
    });
  })();
</script>

{% schema %}
{
  "name": "40/60 Image + Carousel",
  "settings": [
    { "type": "image_picker", "id": "left_image", "label": "Left image" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "New Skin & Hair Care Products" },
    { "type": "collection", "id": "collection", "label": "Product collection" },
    { "type": "range", "id": "max_items", "label": "Max products", "min": 3, "max": 12, "step": 1, "default": 6 }
  ],
  "presets": [
    { "name": "40/60 Image + Carousel" }
  ]
}
{% endschema %}
